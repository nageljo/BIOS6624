---
title: "Project0"
author: "Joseph Nagel"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# read in packages
```{r}
library(tidyverse)
library(naniar)
library(janitor)
```


read in data
```{r}
cort = (
    read_csv('../Data/Project0_Clean_v2.csv', show_col_types = FALSE)
    %>% clean_names()
)
```


```{r}
head(cort)
```

check missingness
```{r}
vis_miss(cort)
```

look at missing outcome values
```{r}
cort %>% filter(is.na(dhea_pg_dl))
```


missing cortisol values are coded as 9999!
```{r}
cort %>% filter(`Cortisol (ug/dl)` == 9999)
```

# Questions from class
Some samples are missing values why how
    time recorded by no value
        sample provided but it could not be analysed (nothing we can do)
    
participant recorded a time they woke up (use this)
    analyse time since waking (not sample intervals)
    
Missing data in cap times by be due to user error    

What is agreement in times Q1?
    scatter plot of cap time since wake vs booklet time since wake
        is there a strong correlation or association?
    is one earlier or later than the other or are they similar
    
9999 is missing in cortizol

Q3: changes over time?
    we expect cortizol to spike 30 mins after waking and gradually decrease over the next 10 hours
        we want to know if we are seeing the expected trends using the spit papers (can we catch the trend)
        what is the difference between wake and 30 mins?
        what is the rate of decline after 30 mins?
            this is a piecewise regression question
            
Use nmol/ml for both measures!

Q1 Q2: statistical or just descriptive?
    Q1: correlation p-value and significant bias between measurements
    Q2: descriptive okay
    
Q2: what is adhering? (same for 30 min and 10 hour points)
    good adherance is 7.5 mins before or after the timepoint
    adiquite is 15 mins before or after
    
We have different days
    this is our problem

User error messes up the cap... are bad values
    some cap times may be inaccurate
    
What is the expected range of the outcomes?
    cortizol nmol/ml biological range:
        over 26 is high but possible
        over 80 is probably incorrect (lab error)
    dhea nmol/ml
        upper detection limit is 5.205 (5.205s are likely an error unless 1 person has repeated high measures in either case consider excluding them)
        
# Analysis Plan

## Q1

Create scatterplot of captime since wake ve booklet time since wake (DO THIS)
Calculate a correlation + p-value
Check for bias i.e. one value consistently lower or higher
    one-sample t-test of mean zero
    
use a mixed model for this since we have repeated measures

could use descriptive statistics on the differences

what are the differences in missingness between the groups
    
## Q2

what proportion of people make it within 7.5 minute window?

what proportion of people make it within 15 minute window?

## Q3
        
use the time you think is best from a statistical point of view


